<ion-view title="My Menu" hide-back-button="true">
    <div class="bar bar-subheader">
        <div class="button-bar">
            <a class="button" ng-click="vm.go('app.dishes')">Manage</a>
            <a class="button button-positive">Sell</a>
        </div>
    </div>
    <ion-content class="has-header has-subheader">
        <div class="list">

            <p class="padding" align="center" ng-if="vm.dishes.length===0">
                You need to create a dish before being able to sell it!<br>
                <a href ng-click="vm.go('app.dishes', {v:'new'})">Add a new dish</a>
            </p>

            <p class="padding" align="center" ng-if="vm.dishes.length>0 && vm.batches.length===0">
                No items on sale.
            </p>

            <div class="item item-avatar" ng-if="vm.dishes.length>0" ng-repeat="batch in vm.batches">
                <img ng-src="{{batch.dish.picture || 'images/logo.png'}}">

                <h2>{{batch.dish.title}}</h2>

                <p>{{::batch.start_time | amDateFormat:'ddd, MMM D (ha'}} to {{::batch.end_time
                    | amDateFormat:'ha'}})</p>

                <p ng-if="batch.remaining > 0" class="title">
                    {{batch.remaining}} portion{{batch.remaining===1 ? "" : "s"}} available
                    <a href class="item-note" ng-click="vm.deleteBatch(batch)">
                        <i class="icon ion-minus-circled"></i> Remove
                    </a>
                </p>


                <div class="hc-orders">
                    <p class="title">{{batch.orders.length || 0}} order{{batch.orders.length===1 ?
                        "" : "s"}}</p>

                    <div ng-repeat="order in batch.orders" class="hc-order" ng-click="vm.showBatchOrder(order)">
                        <img ng-src="{{order.user.picture || 'images/user.png'}}" width="100%">

                        <div class="hc-order-username">{{::order.user.first_name}} {{::order.user.last_name}}</div>
                        <div class="hc-order-quantity">{{::order.quantity}}</div>
                    </div>
                </div>
            </div>
            <button class="button button-block button-positive button-clear" ng-click="vm.openAddBatch()"
                    ng-if="vm.dishes.length>0" ng-disabled="vm.batches.length>=vm.maxBatches">
                Add Dish
            </button>
            <div align="center" ng-if="vm.dishes.length>0 && vm.batches.length>=vm.maxBatches"
                 class="item item-text-wrap">You can have maximum {{vm.maxBatches}} items on sale.
                After you sell and deliver all the items, you will be able to add new ones.
            </div>
        </div>

    </ion-content>
</ion-view>
